<div class="page">
  <!-- Toast notification -->
  <div class="toast" *ngIf="toast">{{ toast }}</div>

  <!-- Success State -->
  <div class="success-container" *ngIf="orderSuccess">
    <div class="success-card card">
      <div class="success-icon">‚úì</div>
      <h2>Order Placed Successfully!</h2>
      <p class="text-muted">Your order ID is:</p>
      <div class="order-id">{{ orderId }}</div>
      <p class="text-sm text-muted mt-2">
        Save this ID to track your order status
      </p>
      <div class="success-actions">
        <button class="btn btn-primary" (click)="trackOrder()">
          Track Order
        </button>
        <button class="btn btn-secondary" (click)="continueShopping()">
          Continue Shopping
        </button>
      </div>
    </div>
  </div>

  <!-- Cart Content -->
  <div class="cart-container" *ngIf="!orderSuccess">
    <h1 class="cart-title">Your Cart</h1>

    <!-- Empty State -->
    <div class="empty-cart card" *ngIf="items.length === 0">
      <h3>Your cart is empty</h3>
      <p class="text-muted">Add some delicious pizzas to get started!</p>
      <button class="btn btn-primary" (click)="continueShopping()">
        Browse Menu
      </button>
    </div>

    <!-- Cart Items -->
    <div class="cart-content" *ngIf="items.length > 0">
      <div class="cart-items">
        <div class="cart-item card" *ngFor="let item of items">
          <div class="item-emoji">üçï</div>
          <div class="item-details">
            <h4>{{ item.name }}</h4>
            <p class="text-muted">${{ item.unitPrice.toFixed(2) }} each</p>
          </div>
          <div class="item-quantity">
            <button 
              class="qty-btn" 
              (click)="updateQuantity(item, -1)"
              [disabled]="item.quantity <= 1"
            >‚àí</button>
            <span class="qty-value">{{ item.quantity }}</span>
            <button class="qty-btn" (click)="updateQuantity(item, 1)">+</button>
          </div>
          <div class="item-total">
            ${{ item.totalPrice.toFixed(2) }}
          </div>
          <button class="btn-remove" (click)="removeItem(item.cartItemId)">
            ‚úï
          </button>
        </div>
      </div>

      <!-- Order Form -->
      <div class="order-form card">
        <h3>Delivery Details</h3>
        
        <div class="form-group">
          <label for="customer">Your Name *</label>
          <span class="field-hint">Letters only, max one space (e.g., Mike Johnson)</span>
          <input 
            id="customer"
            type="text" 
            [(ngModel)]="customer" 
            (input)="onNameInput()"
            (blur)="validateName()"
            placeholder="Mike Johnson"
            [class.invalid]="nameError"
            required
          >
          <span class="error-text" *ngIf="nameError">{{ nameError }}</span>
        </div>

        <div class="form-group">
          <label for="phone">Phone Number *</label>
          <span class="field-hint">Must start with + followed by numbers only (e.g., +38970123456)</span>
          <input 
            id="phone"
            type="tel" 
            [(ngModel)]="phone" 
            (input)="onPhoneInput()"
            (blur)="validatePhone()"
            placeholder="+38970123456"
            [class.invalid]="phoneError"
            required
          >
          <span class="error-text" *ngIf="phoneError">{{ phoneError }}</span>
        </div>

        <div class="form-group">
          <label for="address">Delivery Address *</label>
          <textarea 
            id="address"
            [(ngModel)]="address" 
            placeholder="123 Pizza Street, City"
            rows="3"
            required
          ></textarea>
        </div>

        <div class="form-group priority-option">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="priority">
            <span>
              <strong>Priority Order</strong>
              <small class="text-muted">(+20% for faster delivery)</small>
            </span>
          </label>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
          <div class="summary-row">
            <span>Subtotal</span>
            <span>${{ total.toFixed(2) }}</span>
          </div>
          <div class="summary-row" *ngIf="priority">
            <span>Priority Fee (20%)</span>
            <span>${{ priorityFee.toFixed(2) }}</span>
          </div>
          <div class="summary-row total">
            <span>Total</span>
            <span class="price">${{ grandTotal.toFixed(2) }}</span>
          </div>
        </div>

        <div class="error-message" *ngIf="error">
          {{ error }}
        </div>

        <button 
          class="btn btn-primary btn-lg btn-block"
          (click)="submitOrder()"
          [disabled]="!isFormValid() || isSubmitting"
        >
          <span *ngIf="!isSubmitting">Place Order</span>
          <span *ngIf="isSubmitting">Placing Order...</span>
        </button>
      </div>
    </div>
  </div>
</div>
